<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Comparativa - UTS Saber Pro</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <div class="logo-icon">UTS</div>
            <div class="logo-text">UTS Saber Pro</div>
        </div>
        
        <nav class="nav-menu">
            <a th:href="@{/estudiante/dashboard}" class="nav-link">Mi Dashboard</a>
            <a th:href="@{/estudiante/identificacion}" class="nav-link">Mi Identificaci√≥n</a>
            <a th:href="@{/estudiante/resultado-unico}" class="nav-link">Mi Resultado</a>
            <a th:href="@{/estudiante/resultados-totales}" class="nav-link">Todos Mis Resultados</a>
            <a href="#" class="nav-link active">Mi Comparativa</a>
            <a th:href="@{/estudiante/beneficios}" class="nav-link">Mis Beneficios</a>
        </nav>
        
        <div class="user-info">
            <span th:text="'Bienvenido, ' + ${estudiante.primerNombre}"></span>
            <a th:href="@{/logout}" class="btn btn-secondary btn-sm">Cerrar Sesi√≥n</a>
        </div>
    </header>

    <main class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Mi Comparativa de Resultados</h1>
            <p class="dashboard-subtitle">Compara tu desempe√±o con promedios institucionales y nacionales</p>
        </div>

        <!-- Overall Comparison -->
        <div th:if="${!resultados.isEmpty()}" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 5px 20px var(--color-sombra); margin-bottom: 20px;">
            <h3 style="color: var(--color-verde-texto); margin-bottom: 25px;">üìä Comparativa General</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <!-- Current Result -->
                <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, var(--color-verde-claro), var(--color-verde-medio)); color: white; border-radius: 10px;">
                    <div style="font-size: 14px; opacity: 0.9;">TU PUNTAJE</div>
                    <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" th:text="${ultimoResultado.puntajeGlobal}"></div>
                    <div style="font-size: 16px; opacity: 0.9;" th:text="${ultimoResultado.tipoPrueba == 'SABER_PRO'} ? '/300 puntos' : '/200 puntos'"></div>
                    <div style="margin-top: 10px; font-size: 14px;" th:text="${ultimoResultado.nivelGlobal}"></div>
                </div>
                
                <!-- Institutional Average -->
                <div style="text-align: center; padding: 25px; border: 2px solid var(--color-gris-claro); border-radius: 10px;">
                    <div style="font-size: 14px; color: var(--color-gris-texto);">PROMEDIO UTS</div>
                    <div style="font-size: 36px; font-weight: bold; color: var(--color-verde-texto); margin: 10px 0;" 
                         th:text="${promedioInstitucional} != null ? ${#numbers.formatDecimal(promedioInstitucional, 1, 2)} : 'N/A'"></div>
                    <div style="font-size: 16px; color: var(--color-gris-texto);" th:text="${ultimoResultado.tipoPrueba == 'SABER_PRO'} ? '/300 puntos' : '/200 puntos'"></div>
                    <div th:if="${diferenciaInstitucional != null}" style="margin-top: 10px;">
                        <span th:if="${diferenciaInstitucional > 0}" style="color: #28a745; font-weight: bold;">‚Üë +<span th:text="${diferenciaInstitucional}"></span> pts</span>
                        <span th:if="${diferenciaInstitucional < 0}" style="color: #dc3545; font-weight: bold;">‚Üì <span th:text="${diferenciaInstitucional}"></span> pts</span>
                        <span th:if="${diferenciaInstitucional == 0}" style="color: #6c757d; font-weight: bold;">= Igual</span>
                    </div>
                </div>
                
                <!-- National Average -->
                <div style="text-align: center; padding: 25px; border: 2px solid var(--color-gris-claro); border-radius: 10px;">
                    <div style="font-size: 14px; color: var(--color-gris-texto);">PROMEDIO NACIONAL</div>
                    <div style="font-size: 36px; font-weight: bold; color: var(--color-verde-texto); margin: 10px 0;" 
                         th:text="${promedioNacional} != null ? ${#numbers.formatDecimal(promedioNacional, 1, 2)} : 'N/A'"></div>
                    <div style="font-size: 16px; color: var(--color-gris-texto);" th:text="${ultimoResultado.tipoPrueba == 'SABER_PRO'} ? '/300 puntos' : '/200 puntos'"></div>
                    <div th:if="${diferenciaNacional != null}" style="margin-top: 10px;">
                        <span th:if="${diferenciaNacional > 0}" style="color: #28a745; font-weight: bold;">‚Üë +<span th:text="${diferenciaNacional}"></span> pts</span>
                        <span th:if="${diferenciaNacional < 0}" style="color: #dc3545; font-weight: bold;">‚Üì <span th:text="${diferenciaNacional}"></span> pts</span>
                        <span th:if="${diferenciaNacional == 0}" style="color: #6c757d; font-weight: bold;">= Igual</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Competencies Comparison -->
        <div th:if="${!resultados.isEmpty()}" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 5px 20px var(--color-sombra); margin-bottom: 20px;">
            <h3 style="color: var(--color-verde-texto); margin-bottom: 25px;">üéØ Comparativa por Competencias</h3>
            
            <div style="display: grid; gap: 20px;">
                <div th:each="competencia : ${competenciasComparativa}" 
                     style="border: 1px solid var(--color-gris-claro); border-radius: 8px; padding: 20px;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: var(--color-verde-texto); margin: 0;" th:text="${competencia.nombre}"></h4>
                        <span th:switch="${competencia.estado}" class="badge">
                            <span th:case="'SUPERIOR'" class="badge-success">Superior</span>
                            <span th:case="'SIMILAR'" class="badge-warning">Similar</span>
                            <span th:case="'INFERIOR'" class="badge-danger">Inferior</span>
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; align-items: center;">
                        <!-- Tu Puntaje -->
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: var(--color-gris-texto);">Tu Puntaje</div>
                            <div style="font-size: 24px; font-weight: bold; color: var(--color-verde-texto);" 
                                 th:text="${competencia.tuPuntaje}"></div>
                        </div>
                        
                        <!-- Comparaci√≥n Visual -->
                        <div style="text-align: center;">
                            <div th:if="${competencia.diferencia > 0}" style="color: #28a745; font-size: 20px;">‚Üë</div>
                            <div th:if="${competencia.diferencia < 0}" style="color: #dc3545; font-size: 20px;">‚Üì</div>
                            <div th:if="${competencia.diferencia == 0}" style="color: #6c757d; font-size: 20px;">=</div>
                            <div style="font-size: 12px; color: var(--color-gris-texto);" 
                                 th:text="${competencia.diferencia > 0} ? '+' + ${competencia.diferencia} : ${competencia.diferencia}"></div>
                        </div>
                        
                        <!-- Promedio Institucional -->
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: var(--color-gris-texto);">Promedio UTS</div>
                            <div style="font-size: 20px; font-weight: bold; color: var(--color-gris-texto);" 
                                 th:text="${competencia.promedioInstitucional}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Over Time -->
        <div th:if="${resultados.size() > 1}" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 5px 20px var(--color-sombra); margin-bottom: 20px;">
            <h3 style="color: var(--color-verde-texto); margin-bottom: 25px;">üìà Evoluci√≥n de Tu Desempe√±o</h3>
            
            <div style="display: grid; gap: 15px;">
                <div th:each="resultado, iter : ${resultados}" 
                     style="display: grid; grid-template-columns: 100px 1fr auto; gap: 15px; align-items: center; padding: 15px; border-bottom: 1px solid var(--color-gris-claro);">
                    <div style="font-size: 14px; color: var(--color-gris-texto);" 
                         th:text="${#temporals.format(resultado.fechaExamen, 'MMM yyyy')}"></div>
                    
                    <div>
                        <div style="font-weight: bold; color: var(--color-verde-texto);" 
                             th:text="${resultado.tipoPrueba == 'SABER_PRO'} ? 'Saber Pro' : 'Saber T&T'"></div>
                        <div style="font-size: 12px; color: var(--color-gris-texto);" 
                             th:text="${resultado.nivelGlobal}"></div>
                    </div>
                    
                    <div style="text-align: right;">
                        <div style="font-size: 20px; font-weight: bold; color: var(--color-verde-texto);" 
                             th:text="${resultado.puntajeGlobal}"></div>
                        <div th:if="${iter.index > 0}" style="font-size: 12px;">
                            <span th:if="${resultado.puntajeGlobal > resultados[iter.index-1].puntajeGlobal}" 
                                  style="color: #28a745;">‚Üë +<span th:text="${resultado.puntajeGlobal - resultados[iter.index-1].puntajeGlobal}"></span></span>
                            <span th:if="${resultado.puntajeGlobal < resultados[iter.index-1].puntajeGlobal}" 
                                  style="color: #dc3545;">‚Üì <span th:text="${resultado.puntajeGlobal - resultados[iter.index-1].puntajeGlobal}"></span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommendations -->
        <div th:if="${!resultados.isEmpty()}" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 20px var(--color-sombra); margin-bottom: 20px;">
            <h3 style="color: var(--color-verde-texto); margin-bottom: 20px;">üí° Recomendaciones para Mejorar</h3>
            
            <div style="display: grid; gap: 15px;">
                <div th:each="recomendacion : ${recomendaciones}" 
                     style="display: flex; gap: 15px; align-items: start; padding: 15px; background: var(--color-fondo-input); border-radius: 8px;">
                    <div style="font-size: 20px;" th:text="${recomendacion.emoji}"></div>
                    <div>
                        <strong th:text="${recomendacion.titulo}" style="color: var(--color-verde-texto);"></strong>
                        <p style="margin: 5px 0 0 0; color: var(--color-gris-texto);" th:text="${recomendacion.descripcion}"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Results Message -->
        <div th:if="${resultados.isEmpty()}" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 80px; margin-bottom: 20px;">üìä</div>
            <h2 style="color: white; margin-bottom: 15px;">A√∫n no hay resultados para comparar</h2>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
                Una vez presentes las pruebas, podr√°s ver comparativas con promedios institucionales y recomendaciones personalizadas.
            </p>
            <a th:href="@{/estudiante/dashboard}" class="btn btn-primary">Volver al Dashboard</a>
        </div>

        <!-- Action Buttons -->
        <div th:if="${!resultados.isEmpty()}" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <a th:href="@{/estudiante/dashboard}" class="btn btn-secondary">
                ‚Üê Volver al Dashboard
            </a>
            <a th:href="@{/estudiante/resultados-totales}" class="btn btn-primary">
                üìä Ver Todos Mis Resultados
            </a>
            <button onclick="window.print()" class="btn btn-primary">
                üñ®Ô∏è Imprimir Comparativa
            </button>
        </div>
    </main>

    <style>
        .comparison-card {
            text-align: center;
            padding: 25px;
            border-radius: 10px;
        }
        
        .comparison-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .competency-comparison {
            border: 1px solid var(--color-gris-claro);
            border-radius: 8px;
            padding: 20px;
        }
        
        .progress-item {
            display: grid;
            grid-template-columns: 100px 1fr auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--color-gris-claro);
        }
        
        .recommendation-item {
            display: flex;
            gap: 15px;
            align-items: start;
            padding: 15px;
            background: var(--color-fondo-input);
            border-radius: 8px;
        }
        
        @media (max-width: 768px) {
            .progress-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .competency-comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>